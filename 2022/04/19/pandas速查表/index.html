<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":true,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="导入库包12345import pandas as pd  # 最新为 1.4.1 版本 (2022-02-12)import numpy as npimport matplotlib.pyplot as pltimport seaborn as sns%matplotlib inline 导入数据12345678910111213141516171819# 从 CSV 文件导入数据pd.read">
<meta property="og:type" content="article">
<meta property="og:title" content="pandas速查">
<meta property="og:url" content="http://example.com/2022/04/19/pandas%E9%80%9F%E6%9F%A5%E8%A1%A8/index.html">
<meta property="og:site_name" content="mikoto&#39;s blog">
<meta property="og:description" content="导入库包12345import pandas as pd  # 最新为 1.4.1 版本 (2022-02-12)import numpy as npimport matplotlib.pyplot as pltimport seaborn as sns%matplotlib inline 导入数据12345678910111213141516171819# 从 CSV 文件导入数据pd.read">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-04-19T07:30:27.000Z">
<meta property="article:modified_time" content="2022-04-19T07:32:01.169Z">
<meta property="article:author" content="mikoto">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2022/04/19/pandas%E9%80%9F%E6%9F%A5%E8%A1%A8/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"http://example.com/2022/04/19/pandas%E9%80%9F%E6%9F%A5%E8%A1%A8/","path":"2022/04/19/pandas速查表/","title":"pandas速查"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>pandas速查 | mikoto's blog</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">mikoto's blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">撸猫喝奶茶, 追星看动画</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E5%BA%93%E5%8C%85"><span class="nav-number">1.</span> <span class="nav-text">导入库包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">2.</span> <span class="nav-text">导入数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%BC%E5%87%BA%E6%95%B0%E6%8D%AE"><span class="nav-number">3.</span> <span class="nav-text">导出数据</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%B5%8B%E8%AF%95%E5%AF%B9%E8%B1%A1"><span class="nav-number">4.</span> <span class="nav-text">创建测试对象</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9F%A5%E7%9C%8B-%E6%A3%80%E6%9F%A5-%E7%BB%9F%E8%AE%A1-%E5%B1%9E%E6%80%A7"><span class="nav-number">5.</span> <span class="nav-text">查看, 检查, 统计, 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E7%90%86"><span class="nav-number">6.</span> <span class="nav-text">数据清理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86"><span class="nav-number">7.</span> <span class="nav-text">数据处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E9%80%89%E5%8F%96"><span class="nav-number">8.</span> <span class="nav-text">数据选取</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AEgroup-by-%E9%80%8F%E8%A7%86"><span class="nav-number">9.</span> <span class="nav-text">数据group by 透视</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE-%E5%90%88%E5%B9%B6"><span class="nav-number">10.</span> <span class="nav-text">数据 合并</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%A4%84%E7%90%86"><span class="nav-number">11.</span> <span class="nav-text">时间处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%A4%87%E5%BF%98"><span class="nav-number">12.</span> <span class="nav-text">常用备忘</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B7%E5%BC%8F%E5%B1%95%E7%A4%BA"><span class="nav-number">13.</span> <span class="nav-text">样式展示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A8%E6%A0%BC%E4%B8%AD%E7%9B%B4%E6%96%B9%E5%9B%BE-sparkline%E5%9B%BE"><span class="nav-number">14.</span> <span class="nav-text">表格中直方图, sparkline图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="nav-number">15.</span> <span class="nav-text">可视化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">15.1.</span> <span class="nav-text">常用方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#notebook%E9%97%AE%E9%A2%98"><span class="nav-number">16.</span> <span class="nav-text">notebook问题</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="mikoto"
      src="https://s1.ax1x.com/2022/04/07/qzJ0Wd.png">
  <p class="site-author-name" itemprop="name">mikoto</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/xiaopeipeiya123" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;xiaopeipeiya123" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:848063625@qq.com" title="E-Mail → mailto:848063625@qq.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2022/04/19/pandas%E9%80%9F%E6%9F%A5%E8%A1%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://s1.ax1x.com/2022/04/07/qzJ0Wd.png">
      <meta itemprop="name" content="mikoto">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="mikoto's blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="pandas速查 | mikoto's blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          pandas速查
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-04-19 15:30:27 / 修改时间：15:32:01" itemprop="dateCreated datePublished" datetime="2022-04-19T15:30:27+08:00">2022-04-19</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h3 id="导入库包"><a href="#导入库包" class="headerlink" title="导入库包"></a>导入库包</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import pandas as pd  # 最新为 1.4.1 版本 (2022-02-12)</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import seaborn as sns</span><br><span class="line">%matplotlib inline</span><br></pre></td></tr></table></figure>
<h3 id="导入数据"><a href="#导入数据" class="headerlink" title="导入数据"></a>导入数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 从 CSV 文件导入数据</span><br><span class="line">pd.read_csv(&#x27;file.csv&#x27;, name=[&#x27;列名&#x27;,&#x27;列名2&#x27;])</span><br><span class="line"># 从限定分隔符的文本文件导入数据</span><br><span class="line">pd.read_table(filename, header=0)</span><br><span class="line"># Excel 导入，指定 sheet 和表头</span><br><span class="line">pd.read_excel(&#x27;file.xlsx&#x27;, sheet_name=&#x27; 表1&#x27;, header=0)</span><br><span class="line"># 从 SQL 表/库导入数据</span><br><span class="line">pd.read_sql(query, connection_object)</span><br><span class="line"># 从 JSON 格式的字符串导入数据</span><br><span class="line">pd.read_json(json_string)</span><br><span class="line"># 解析 URL、字符串或者 HTML 文件，抽取其中的 tables 表格</span><br><span class="line">pd.read_html(url)</span><br><span class="line"># 从你的粘贴板获取内容，并传给 read_table()</span><br><span class="line">pd.read_clipboard()</span><br><span class="line"># 从字典对象导入数据，Key 是列名，Value是数据</span><br><span class="line">pd.DataFrame(dict)</span><br><span class="line"># 导入字符串</span><br><span class="line">from io import StringIO</span><br><span class="line">pd.read_csv(StringIO(web_data.text))</span><br></pre></td></tr></table></figure>
<h3 id="导出数据"><a href="#导出数据" class="headerlink" title="导出数据"></a>导出数据</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 导出数据到CSV文件</span><br><span class="line">df.to_csv(&#x27;filename.csv&#x27;)</span><br><span class="line"># 导出数据到Excel文件</span><br><span class="line">df.to_excel(&#x27;filename.xlsx&#x27;, index=True)</span><br><span class="line"># 导出数据到 SQL 表</span><br><span class="line">df.to_sql(table_name, connection_object)</span><br><span class="line"># 以Json格式导出数据到文本文件</span><br><span class="line">df.to_json(filename)</span><br><span class="line"># 其他</span><br><span class="line">df.to_html()  # 显示 HTML 代码</span><br><span class="line">df.to_markdown() # 显示 markdown 代码</span><br><span class="line">df.to_string() # 显示格式化字符</span><br><span class="line">df.to_latex(index=False) # LaTeX tabular, longtable</span><br><span class="line">df.to_dict(&#x27;split&#x27;) # 字典, 格式 list/series/records/index</span><br><span class="line">df.to_clipboard(sep=&#x27;,&#x27;, index=False) # 存入系统剪贴板</span><br><span class="line"></span><br><span class="line"># 将两个表格输出到一个excel文件里面,导出到多个 sheet</span><br><span class="line">writer=pd.ExcelWriter(&#x27;new.xlsx&#x27;)</span><br><span class="line">df_1.to_excel(writer,sheet_name=&#x27;第一个&#x27;, index=False)</span><br><span class="line">df_2.to_excel(writer,sheet_name=&#x27;第二个&#x27;, index=False)</span><br><span class="line">writer.save() # 必须运行writer.save()，不然不能输出到本地</span><br><span class="line"></span><br><span class="line"># 写法2</span><br><span class="line">with pd.ExcelWriter(&#x27;new.xlsx&#x27;) as writer:</span><br><span class="line">    df1.to_excel(writer, sheet_name=&#x27;第一个&#x27;)</span><br><span class="line">    df2.to_excel(writer, sheet_name=&#x27;第二个&#x27;)</span><br><span class="line"># 用 xlsxwriter 导出支持合并单元格、颜色、图表等定制功能</span><br><span class="line"># https://xlsxwriter.readthedocs.io/working_with_pandas.html</span><br></pre></td></tr></table></figure>
<h3 id="创建测试对象"><a href="#创建测试对象" class="headerlink" title="创建测试对象"></a>创建测试对象</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 创建20行5列的随机数组成的 DataFrame 对象</span><br><span class="line">pd.DataFrame(np.random.rand(20,5))</span><br><span class="line"># 从可迭代对象 my_list 创建一个 Series 对象</span><br><span class="line">pd.Series(my_list)</span><br><span class="line"># 增加一个日期索引</span><br><span class="line">df.index = pd.date_range(&#x27;1900/1/30&#x27;, periods=df.shape[0])</span><br><span class="line"># 创建随机数据集</span><br><span class="line">df = pd.util.testing.makeDataFrame()</span><br><span class="line"># 创建随机日期索引数据集</span><br><span class="line">df = pd.util.testing.makePeriodFrame()</span><br><span class="line">df = pd.util.testing.makeTimeDataFrame()</span><br><span class="line"># 创建随机混合类型数据集</span><br><span class="line">df = pd.util.testing.makeMixedDataFrame()</span><br></pre></td></tr></table></figure>
<h3 id="查看-检查-统计-属性"><a href="#查看-检查-统计-属性" class="headerlink" title="查看, 检查, 统计, 属性"></a>查看, 检查, 统计, 属性</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">df.head(n) # 查看 DataFrame 对象的前n行</span><br><span class="line">df.tail(n) # 查看 DataFrame 对象的最后n行</span><br><span class="line">df.sample(n) # 查看 n 个样本，随机</span><br><span class="line">df.shape # 查看行数和列数</span><br><span class="line">df.info() # 查看索引、数据类型和内存信息</span><br><span class="line">df.describe() # 查看数值型列的汇总统计</span><br><span class="line">df.dtypes # 查看各字段类型</span><br><span class="line">df.axes # 显示数据行和列名</span><br><span class="line">df.mean() # 返回所有列的均值</span><br><span class="line">df.mean(1) # 返回所有行的均值，下同</span><br><span class="line">df.corr() # 返回列与列之间的相关系数</span><br><span class="line">df.count() # 返回每一列中的非空值的个数</span><br><span class="line">df.max() # 返回每一列的最大值</span><br><span class="line">df.min() # 返回每一列的最小值</span><br><span class="line">df.median() # 返回每一列的中位数</span><br><span class="line">df.std() # 返回每一列的标准差</span><br><span class="line">df.var() # 方差</span><br><span class="line">s.mode() # 众数</span><br><span class="line">s.prod() # 连乘</span><br><span class="line">s.cumprod() # 累积连乘,累乘</span><br><span class="line">df.cumsum(axis=0) # 累积连加,累加</span><br><span class="line">s.nunique() # 去重数量，不同值的量</span><br><span class="line">df.idxmax() # 每列最大的值的索引名</span><br><span class="line">df.idxmin() # 最小</span><br><span class="line">df.columns # 显示所有列名</span><br><span class="line">df.team.unique() # 显示列中的不重复值</span><br><span class="line"># 查看 Series 对象的唯一值和计数, 计数占比: normalize=True</span><br><span class="line">s.value_counts(dropna=False)</span><br><span class="line"># 查看 DataFrame 对象中每一列的唯一值和计数</span><br><span class="line">df.apply(pd.Series.value_counts)</span><br><span class="line">df.duplicated() # 重复行</span><br><span class="line">df.drop_duplicates() # 删除重复行</span><br><span class="line"># set_option、reset_option、describe_option 设置显示要求</span><br><span class="line">pd.get_option()</span><br><span class="line"># 设置行列最大显示数量，None 为不限制</span><br><span class="line">pd.options.display.max_rows = None</span><br><span class="line">pd.options.display.max_columns = None</span><br><span class="line">df.col.argmin() # 最大值[最小值 .argmax()] 所在位置的自动索引</span><br><span class="line">df.col.idxmin() # 最大值[最小值 .idxmax()] 所在位置的定义索引</span><br><span class="line"># 累计统计</span><br><span class="line">ds.cumsum() # 前边所有值之和</span><br><span class="line">ds.cumprod() # 前边所有值之积</span><br><span class="line">ds.cummax() # 前边所有值的最大值</span><br><span class="line">ds.cummin() # 前边所有值的最小值</span><br><span class="line"># 窗口计算(滚动计算)</span><br><span class="line">ds.rolling(x).sum() #依次计算相邻x个元素的和</span><br><span class="line">ds.rolling(x).mean() #依次计算相邻x个元素的算术平均</span><br><span class="line">ds.rolling(x).var() #依次计算相邻x个元素的方差</span><br><span class="line">ds.rolling(x).std() #依次计算相邻x个元素的标准差</span><br><span class="line">ds.rolling(x).min() #依次计算相邻x个元素的最小值</span><br><span class="line">ds.rolling(x).max() #依次计算相邻x个元素的最大值</span><br></pre></td></tr></table></figure>
<h3 id="数据清理"><a href="#数据清理" class="headerlink" title="数据清理"></a>数据清理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">df.columns = [&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;] # 重命名列名</span><br><span class="line">df.columns = df.columns.str.replace(&#x27; &#x27;, &#x27;_&#x27;) # 列名空格换下划线</span><br><span class="line">df.loc[df.AAA &gt;= 5, [&#x27;BBB&#x27;, &#x27;CCC&#x27;]] = 555 # 替换数据</span><br><span class="line">df[&#x27;pf&#x27;] = df.site_id.map(&#123;2: &#x27;小程序&#x27;, 7:&#x27;M 站&#x27;&#125;) # 将枚举换成名称</span><br><span class="line">pd.isnull() # 检查DataFrame对象中的空值，并返回一个 Boolean 数组</span><br><span class="line">pd.notnull() # 检查DataFrame对象中的非空值，并返回一个 Boolean 数组</span><br><span class="line">df.drop([&#x27;name&#x27;], axis=1) # 删除列</span><br><span class="line">df.drop([0, 10], axis=0) # 删除行</span><br><span class="line">del df[&#x27;name&#x27;] # 删除列</span><br><span class="line">df.dropna() # 删除所有包含空值的行</span><br><span class="line">df.dropna(axis=1) # 删除所有包含空值的列</span><br><span class="line">df.dropna(axis=1,thresh=n) # 删除所有小于 n 个非空值的行</span><br><span class="line">df.fillna(x) # 用x替换DataFrame对象中所有的空值</span><br><span class="line">df.fillna(value=&#123;&#x27;prov&#x27;:&#x27;未知&#x27;&#125;) # 指定列的空值替换为指定内容</span><br><span class="line">s.astype(float) # 将Series中的数据类型更改为 float 类型</span><br><span class="line">df.index.astype(&#x27;datetime64[ns]&#x27;) # 转化为时间格式</span><br><span class="line">s.replace(1, &#x27;one&#x27;) # 用 ‘one’ 代替所有等于 1 的值</span><br><span class="line">s.replace([1, 3],[&#x27;one&#x27;,&#x27;three&#x27;]) # 用&#x27;one&#x27;代替 1，用 &#x27;three&#x27; 代替 3</span><br><span class="line">df.rename(columns=lambda x: x + 1) # 批量更改列名</span><br><span class="line">df.rename(columns=&#123;&#x27;old_name&#x27;: &#x27;new_name&#x27;&#125;) # 选择性更改列名</span><br><span class="line">df.set_index(&#x27;column_one&#x27;) # 更改索引列</span><br><span class="line">df.rename(index=lambda x: x + 1) # 批量重命名索引</span><br><span class="line"># 重新命名表头名称</span><br><span class="line">df.columns = [&#x27;UID&#x27;, &#x27;当前待打款金额&#x27;, &#x27;认证姓名&#x27;]</span><br><span class="line">df[&#x27;是否设置提现账号&#x27;] = df[&#x27;状态&#x27;] # 复制一列</span><br><span class="line">df.loc[:, ::-1] # 列顺序反转</span><br><span class="line">df.loc[::-1] # 行顺序反转, 下方为重新定义索引</span><br><span class="line">df.loc[::-1].reset_index(drop=True)</span><br></pre></td></tr></table></figure>
<h3 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"># 保留小数位，四舍六入五成双</span><br><span class="line">df.round(2) # 全部</span><br><span class="line">df.round(&#123;&#x27;A&#x27;: 1, &#x27;C&#x27;: 2&#125;) # 指定列</span><br><span class="line">df[&#x27;Name&#x27;] = df.Name # 取列名的两个方法</span><br><span class="line">df[df.index == &#x27;Jude&#x27;] # 按索引查询要用 .index</span><br><span class="line">df[df[col] &gt; 0.5] # 选择col列的值大于0.5的行</span><br><span class="line"># 多条件查询</span><br><span class="line">df[(df[&#x27;team&#x27;] == &#x27;A&#x27;) &amp;</span><br><span class="line">   ( df[&#x27;Q1&#x27;] &gt; 80) &amp;</span><br><span class="line">   df.utype.isin([&#x27;老客&#x27;, &#x27;老访客&#x27;])]</span><br><span class="line"># 筛选为空的内容</span><br><span class="line">df[df.order.isnull()]</span><br><span class="line"># 类似 SQL where in</span><br><span class="line">df[df.team.isin(&#x27;A&#x27;,&#x27;B&#x27;)]</span><br><span class="line">df[(df.team==&#x27;B&#x27;) &amp; (df.Q1 == 17)]</span><br><span class="line">df[~(df[&#x27;team&#x27;] == &#x27;A&#x27;) | ( df[&#x27;Q1&#x27;] &gt; 80)] # 非，或</span><br><span class="line">df[df.Name.str.contains(&#x27;张&#x27;)] # 包含字符</span><br><span class="line">df.sort_values(col1) # 按照列col1排序数据，默认升序排列</span><br><span class="line">df.col1.sort_values() # 同上, -&gt; s</span><br><span class="line">df.sort_values(col2, ascending=False) # 按照列 col1 降序排列数据</span><br><span class="line"># 先按列col1升序排列，后按col2降序排列数据</span><br><span class="line">df.sort_values([col1,col2], ascending=[True,False])</span><br><span class="line">df2 = pd.get_dummies(df, prefix=&#x27;t_&#x27;) # 将枚举的那些列带枚举转到列上</span><br><span class="line">s.set_index().plot()</span><br><span class="line"># 多索引处理</span><br><span class="line">dd.set_index([&#x27;utype&#x27;, &#x27;site_id&#x27;, &#x27;p_day&#x27;], inplace=True)</span><br><span class="line">dd.sort_index(inplace=True) # 按索引排序</span><br><span class="line">dd.loc[&#x27;新访客&#x27;, 2, &#x27;2019-06-22&#x27;].plot.barh() # loc 中按顺序指定索引内容</span><br><span class="line"># 前100行, 不能指定行，如：df[100]</span><br><span class="line">df[:100]</span><br><span class="line"># 只取指定行</span><br><span class="line">df1 = df.loc[0:, [&#x27;设计师ID&#x27;, &#x27;姓名&#x27;]]</span><br><span class="line"># 将ages平分成5个区间并指定 labels</span><br><span class="line">ages = np.array([1,5,10,40,36,12,58,62,77,89,100,18,20,25,30,32])</span><br><span class="line">pd.cut(ages, [0,5,20,30,50,100],</span><br><span class="line">       labels=[u&quot;婴儿&quot;,u&quot;青年&quot;,u&quot;中年&quot;,u&quot;壮年&quot;,u&quot;老年&quot;])</span><br><span class="line"></span><br><span class="line">daily_index.difference(df_work_day.index) # 取出差别</span><br><span class="line"># 格式化</span><br><span class="line">df.index.name # 索引的名称 str</span><br><span class="line">df.columns.tolist()</span><br><span class="line">df.values.tolist()</span><br><span class="line">df.总人口.values.tolist()</span><br><span class="line">data.apply(np.mean) # 对 DataFrame 中的每一列应用函数 np.mean</span><br><span class="line">data.apply(np.max,axis=1) # 对 DataFrame 中的每一行应用函数 np.max</span><br><span class="line">df.insert(1, &#x27;three&#x27;, 12, allow_duplicates=False) # 插入列 (位置、列名、[值])</span><br><span class="line">df.pop(&#x27;class&#x27;) # 删除列</span><br><span class="line"># 增加一行</span><br><span class="line">df.append(pd.DataFrame(&#123;&#x27;one&#x27;:2,</span><br><span class="line">                        &#x27;two&#x27;:3,</span><br><span class="line">                        &#x27;three&#x27;: 4.4&#125;,</span><br><span class="line">                       index=[&#x27;f&#x27;]),</span><br><span class="line">          sort=True)</span><br><span class="line"># 指定新列</span><br><span class="line">iris.assign(sepal_ratio=iris[&#x27;SepalWidth&#x27;] / iris[&#x27;SepalLength&#x27;]).head()</span><br><span class="line">df.assign(rate=lambda df: df.orders/df.uv)</span><br><span class="line"># shift 函数是对数据进行平移动的操作</span><br><span class="line">df[&#x27;增幅&#x27;] = df[&#x27;国内生产总值&#x27;] - df[&#x27;国内生产总值&#x27;].shift(-1)</span><br><span class="line">df.tshift(1) # 时间移动，按周期</span><br><span class="line"># 和上相同，diff 函数是用来将数据进行移动之后与原数据差</span><br><span class="line"># 异数据，等于 df.shift()-df</span><br><span class="line">df[&#x27;增幅&#x27;] = df[&#x27;国内生产总值&#x27;].diff(-1)</span><br><span class="line"># 留存数据，因为最大一般为数据池</span><br><span class="line">df.apply(lambda x: x/x.max(), axis=1)</span><br><span class="line"></span><br><span class="line"># 取 best 列中值为列名的值写到 name 行上</span><br><span class="line">df[&#x27;value&#x27;] = df.lookup(df[&#x27;name&#x27;], df[&#x27;best&#x27;])</span><br><span class="line"></span><br><span class="line">s.where(s &gt; 1, 10) # 满足条件下数据替换（10，空为 NaN）</span><br><span class="line">s.mask(s &gt; 0) # 留下满足条件的，其他的默认为 NaN</span><br><span class="line"># 所有值加 1 (加减乘除等)</span><br><span class="line">df + 1 / df.add(1)</span><br><span class="line"># 管道方法，链式调用函数，f(df)=df.pipe(f)</span><br><span class="line">def gb(df, by):</span><br><span class="line">    result = df.copy()</span><br><span class="line">    result = result.groupby(by).sum()</span><br><span class="line">    return result </span><br><span class="line"># 调用</span><br><span class="line">df.pipe(gb, by=&#x27;team&#x27;)</span><br><span class="line"># 窗口计算 &#x27;2s&#x27; 为两秒</span><br><span class="line">df.rolling(2).sum()</span><br><span class="line"># 在窗口结果基础上的窗口计算</span><br><span class="line">df.expanding(2).sum()</span><br><span class="line"># 超出（大于、小于）的值替换成对应值</span><br><span class="line">df.clip(-4, 6)</span><br><span class="line"># AB 两列想加增加 C 列</span><br><span class="line">df[&#x27;C&#x27;] = df.eval(&#x27;A+B&#x27;)</span><br><span class="line"># 和上相同效果</span><br><span class="line">df.eval(&#x27;C = A + B&#x27;, inplace=True)</span><br><span class="line"># 数列的变化百分比</span><br><span class="line">s.pct_change(periods=2)</span><br><span class="line"># 分位数, 可实现时间的中间点</span><br><span class="line">df.quantile(.5)</span><br><span class="line"># 排名 average, min,max,first，dense, 默认 average</span><br><span class="line">s.rank()</span><br><span class="line"># 数据爆炸，将本列的类列表数据和其他列的数据展开铺开</span><br><span class="line">df.explode(&#x27;A&#x27;)</span><br><span class="line"># 枚举更新</span><br><span class="line">status = &#123;0:&#x27;未执行&#x27;, 1:&#x27;执行中&#x27;, 2:&#x27;执行完毕&#x27;, 3:&#x27;执行异常&#x27;&#125;</span><br><span class="line">df[&#x27;taskStatus&#x27;] = df[&#x27;taskStatus&#x27;].apply(status.get)</span><br><span class="line">df.assign(金额=0) # 新增字段</span><br><span class="line">df.loc[(&#x27;bar&#x27;, &#x27;two&#x27;), &#x27;A&#x27;] # 多索引查询</span><br><span class="line">df.query(&#x27;i0 == &quot;b&quot; &amp; i1 == &quot;b&quot;&#x27;) # 多索引查询方法 2</span><br><span class="line"># 取多索引中指定级别的所有不重复值</span><br><span class="line">df.index.get_level_values(2).unique()</span><br><span class="line"># 去掉为零小数，12.00 -&gt; 12</span><br><span class="line">df.astype(&#x27;str&#x27;).applymap(lambda x: x.replace(&#x27;.00&#x27;, &#x27;&#x27;))</span><br><span class="line"># 插入数据，在第三列加入「两倍」列</span><br><span class="line">df.insert(3, &#x27;两倍&#x27;, df[&#x27;值&#x27;]*2)</span><br><span class="line"># 枚举转换</span><br><span class="line">df[&#x27;gender&#x27;] = df.gender.map(&#123;&#x27;male&#x27;:&#x27;男&#x27;, &#x27;female&#x27;:&#x27;女&#x27;&#125;)</span><br><span class="line"># 增加本行之和列</span><br><span class="line">df[&#x27;Col_sum&#x27;] = df.apply(lambda x: x.sum(), axis=1)</span><br><span class="line"># 对指定行进行加和</span><br><span class="line">col_list= list(df)[2:] # 取请假范围日期</span><br><span class="line">df[&#x27;总天数&#x27;] = df[col_list].sum(axis=1) # 计算总请假天数</span><br><span class="line"># 对列求和，汇总</span><br><span class="line">df.loc[&#x27;col_sum&#x27;] = df.apply(lambda x: x.sum())</span><br><span class="line"># 按指定的列表顺序显示</span><br><span class="line">df.reindex(order_list)</span><br><span class="line"># 按指定的多列排序</span><br><span class="line">df.reindex([&#x27;col_1&#x27;, &#x27;col_5&#x27;], axis=&quot;columns&quot;)</span><br></pre></td></tr></table></figure>
<h3 id="数据选取"><a href="#数据选取" class="headerlink" title="数据选取"></a>数据选取</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">df[col] # 根据列名，并以Series的形式返回列</span><br><span class="line">df[[col1, col2]] # 以DataFrame形式返回多列</span><br><span class="line">df.loc[df[&#x27;team&#x27;] == &#x27;B&#x27;,[&#x27;name&#x27;]] # 按条件查询，只显示name 列</span><br><span class="line">s.iloc[0] # 按位置选取数据</span><br><span class="line">s.loc[&#x27;index_one&#x27;] # 按索引选取数据</span><br><span class="line">df.loc[0,&#x27;A&#x27;:&#x27;B&#x27;] #  A到 B 字段的第一行 </span><br><span class="line">df.loc[2018:1990, &#x27;第一产业增加值&#x27;:&#x27;第三产业增加值&#x27;]</span><br><span class="line">df.loc[0,[&#x27;A&#x27;,&#x27;B&#x27;]] # d.loc[位置切片, 字段]</span><br><span class="line">df.iloc[0,:] # 返回第一行, iloc 只能是数字</span><br><span class="line">df.iloc[0,0] # 返回第一列的第一个元素</span><br><span class="line">dc.query(&#x27;site_id &gt; 8 and utype==&quot;老客&quot;&#x27;).head() # 可以 and or / &amp; |</span><br><span class="line"> # 迭代器及使用</span><br><span class="line">for idx,row in df.iterrows(): row[&#x27;id&#x27;]</span><br><span class="line"># 迭代器对每个元素进行处理</span><br><span class="line">df.loc[i,&#x27;链接&#x27;] = f&#x27;http://www.gairuo.com/p/&#123;slug&#125;.html&#x27;</span><br><span class="line">for i in df.Name:print(i) # 迭代一个列</span><br><span class="line"># 按列迭代，[列名, 列中的数据序列 S（索引名 值)]</span><br><span class="line">for label, content in df.items():print(label, content)</span><br><span class="line"># 按行迭代，迭代出整行包括索引的类似列表的内容，可row[2]取</span><br><span class="line">for row in df.itertuples():print(row)</span><br><span class="line">df.at[2018, &#x27;总人口&#x27;] # 按行列索引名取一个指定的单个元素</span><br><span class="line">df.iat[1, 2] # 索引和列的编号取单个元素</span><br><span class="line">s.nlargest(5).nsmallest(2) # 最大和最小的前几个值</span><br><span class="line">df.nlargest(3, [&#x27;population&#x27;, &#x27;GDP&#x27;])</span><br><span class="line">df.take([0, 3]) # 指定多个行列位置的内容</span><br><span class="line"># 按行列截取掉部分内容，支持日期索引标签</span><br><span class="line">ds.truncate(before=2, after=4)</span><br><span class="line"># 将 dataframe 转成 series</span><br><span class="line">df.iloc[:,0]</span><br><span class="line">float(str(val).rstrip(&#x27;%&#x27;)) # 百分数转数字</span><br><span class="line">df.reset_index(inplace=True) # 取消索引</span><br></pre></td></tr></table></figure>
<h3 id="数据group-by-透视"><a href="#数据group-by-透视" class="headerlink" title="数据group by 透视"></a>数据group by 透视</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">df.groupby(col) # 返回一个按列col进行分组的Groupby对象</span><br><span class="line">df.groupby([col1,col2]) # 返回一个按多列进行分组的Groupby对象</span><br><span class="line">df.groupby(col1)[col2] # 返回按列col1进行分组后，列col2的均值</span><br><span class="line"># 创建一个按列col1进行分组，并计算col2和col3的最大值的数据透视表</span><br><span class="line">df.pivot_table(index=col1,</span><br><span class="line">               values=[col2,col3],</span><br><span class="line">               aggfunc=max,</span><br><span class="line">               as_index=False)</span><br><span class="line"># 同上</span><br><span class="line">df.pivot_table(index=[&#x27;site_id&#x27;, &#x27;utype&#x27;],</span><br><span class="line">               values=[&#x27;uv_all&#x27;, &#x27;regist_num&#x27;],</span><br><span class="line">               aggfunc=[&#x27;max&#x27;, &#x27;mean&#x27;])</span><br><span class="line">df.groupby(col1).agg(np.mean) # 返回按列col1分组的所有列的均值</span><br><span class="line"># 按列将其他列转行</span><br><span class="line">pd.melt(df, id_vars=[&quot;day&quot;], var_name=&#x27;city&#x27;, value_name=&#x27;temperature&#x27;)</span><br><span class="line"># 交叉表是用于统计分组频率的特殊透视表</span><br><span class="line">pd.crosstab(df.Nationality,df.Handedness)</span><br><span class="line"># groupby 后排序，分组 agg 内的元素取固定个数</span><br><span class="line">(</span><br><span class="line">    df[(df.p_day &gt;= &#x27;20190101&#x27;)]</span><br><span class="line">    .groupby([&#x27;p_day&#x27;, &#x27;name&#x27;])</span><br><span class="line">    .agg(&#123;&#x27;uv&#x27;:sum&#125;)</span><br><span class="line">    .sort_values([&#x27;p_day&#x27;,&#x27;uv&#x27;], ascending=[False, False])</span><br><span class="line">    .groupby(level=0).head(5) # 每天取5个页面</span><br><span class="line">    .unstack()</span><br><span class="line">    .plot()</span><br><span class="line">)</span><br><span class="line"># 合并查询经第一个看（max, min, last, size:数量）</span><br><span class="line">df.groupby(&#x27;结算类型&#x27;).first()</span><br><span class="line"># 合并明细并分组统计加总（&#x27;max&#x27;, `mean`, `median`,</span><br><span class="line"># `prod`, `sum`, `std`,`var`, &#x27;nunique&#x27;）,&#x27;nunique&#x27;为去重的列表</span><br><span class="line">df1 = df.groupby(by=&#x27;设计师ID&#x27;).agg(&#123;&#x27;结算金额&#x27;:sum&#125;)</span><br><span class="line">df.groupby(by=df.pf).ip.nunique() # groupby distinct, 分组+去重数</span><br><span class="line">df.groupby(by=df.pf).ip.value_counts() # groupby 分组+去重的值及数量</span><br><span class="line">df.groupby(&#x27;name&#x27;).agg([&#x27;sum&#x27;, &#x27;median&#x27;, &#x27;count&#x27;])</span><br></pre></td></tr></table></figure>
<h3 id="数据-合并"><a href="#数据-合并" class="headerlink" title="数据 合并"></a>数据 合并</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 合并拼接行</span><br><span class="line"># 将df2中的行添加到df1的尾部</span><br><span class="line">df1.append(df2)</span><br><span class="line"># 指定列合并成一个新表新列</span><br><span class="line">ndf = (df[&#x27;提名1&#x27;]</span><br><span class="line">       .append(df[&#x27;提名2&#x27;], ignore_index=True)</span><br><span class="line">       .append(df[&#x27;提名3&#x27;], ignore_index=True))</span><br><span class="line">ndf = pd.DataFrame(ndf, columns=([&#x27;姓名&#x27;]))</span><br><span class="line"># 将df2中的列添加到df1的尾部</span><br><span class="line">df.concat([df1, df2], axis=1)</span><br><span class="line"></span><br><span class="line"># 合并文件的各行</span><br><span class="line">df1 = pd.read_csv(&#x27;111.csv&#x27;, sep=&#x27;\t&#x27;)</span><br><span class="line">df2 = pd.read_csv(&#x27;222.csv&#x27;, sep=&#x27;\t&#x27;)</span><br><span class="line">excel_list = [df1, df2]</span><br><span class="line"># result = pd.concat(excel_list).fillna(&#x27;&#x27;)[:].astype(&#x27;str&#x27;)</span><br><span class="line">result = pd.concat(excel_list)[]</span><br><span class="line">result.to_excel(&#x27;333.xlsx&#x27;, index=False)</span><br><span class="line"></span><br><span class="line"># 合并指定目录下所有的 excel (csv) 文件</span><br><span class="line">import glob</span><br><span class="line">files = glob.glob(&quot;data/cs/*.xls&quot;)</span><br><span class="line">dflist = []</span><br><span class="line">for i in files:</span><br><span class="line">    dflist.append(pd.read_excel(i, usecols=[&#x27;ID&#x27;, &#x27;时间&#x27;, &#x27;名称&#x27;]))</span><br><span class="line"></span><br><span class="line">df = pd.concat(dflist)</span><br><span class="line"></span><br><span class="line"># 合并增加列</span><br><span class="line"># 对df1的列和df2的列执行SQL形式的join</span><br><span class="line">df1.join(df2,on=col1,how=&#x27;inner&#x27;)</span><br><span class="line"># 用 key 合并两个表</span><br><span class="line">df_all = pd.merge(df_sku, df_spu, </span><br><span class="line">                  how=&#x27;left&#x27;,</span><br><span class="line">                  left_on=df_sku[&#x27;product_id&#x27;],</span><br><span class="line">                  right_on=df_spu[&#x27;p.product_id&#x27;])</span><br></pre></td></tr></table></figure>
<h3 id="时间处理"><a href="#时间处理" class="headerlink" title="时间处理"></a>时间处理</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"># 时间索引</span><br><span class="line">df.index = pd.DatetimeIndex(df.index)</span><br><span class="line"># 时间只保留日期</span><br><span class="line">df[&#x27;date&#x27;] = df[&#x27;time&#x27;].dt.date</span><br><span class="line"># 将指定字段格式化为时间类型</span><br><span class="line">df[&quot;date&quot;] = pd.to_datetime(df[&#x27;时间&#x27;])</span><br><span class="line"># 转化为北京时间</span><br><span class="line">df[&#x27;time&#x27;] = df[&#x27;time&#x27;].dt.tz_convert(&#x27;Asia/Shanghai&#x27;)</span><br><span class="line"># 转为指定格式，可能会失去秒以后的精度</span><br><span class="line">df[&#x27;time&#x27;] = df[&#x27;time&#x27;].dt.strftime(&quot;%Y-%m-%d %H:%M:%S&quot;)</span><br><span class="line">dc.index = pd.to_datetime(dc.index, format=&#x27;%Y%m%d&#x27;, errors=&#x27;ignore&#x27;)</span><br><span class="line"># 时间，参与运算</span><br><span class="line">pd.DateOffset(days=2)</span><br><span class="line"># 当前时间</span><br><span class="line">pd.Timestamp.now()</span><br><span class="line">pd.to_datetime(&#x27;today&#x27;)</span><br><span class="line"># 判断时间是否当天</span><br><span class="line">pd.datetime.today().year == df.start_work.dt.year</span><br><span class="line">df.time.astype(&#x27;datetime64[ns]&#x27;).dt.date == pd.to_datetime(&#x27;today&#x27;)</span><br><span class="line"># 定义个天数</span><br><span class="line">import datetime</span><br><span class="line">days = lambda x: datetime.timedelta(days=x)</span><br><span class="line">days(2)</span><br><span class="line"># 同上，直接用 pd 包装的</span><br><span class="line">pd.Timedelta(days=2)</span><br><span class="line"># unix 时间戳</span><br><span class="line">pd.to_datetime(ted.film_date, unit=&#x27;ms&#x27;)</span><br><span class="line"># 按月（YMDHminS）采集合计数据</span><br><span class="line">df.set_index(&#x27;date&#x27;).resample(&#x27;M&#x27;)[&#x27;quantity&#x27;].sum()</span><br><span class="line">df.set_index(&#x27;date&#x27;).groupby(&#x27;name&#x27;)[&#x27;ext price&#x27;].resample(&quot;M&quot;).sum()</span><br><span class="line"># 按天汇总，index 是 datetime 时间类型</span><br><span class="line">df.groupby(by=df.index.date).agg(&#123;&#x27;uu&#x27;:&#x27;count&#x27;&#125;)</span><br><span class="line"># 按周汇总</span><br><span class="line">df.groupby(by=df.index.weekday).uu.count()</span><br><span class="line"># 按月进行汇总</span><br><span class="line">df.groupby([&#x27;name&#x27;, pd.Grouper(key=&#x27;date&#x27;, freq=&#x27;M&#x27;)])[&#x27;ext price&#x27;].sum()</span><br><span class="line"># 按月进行汇总</span><br><span class="line">df.groupby(pd.Grouper(key=&#x27;day&#x27;, freq=&#x27;1M&#x27;)).sum()</span><br><span class="line"># 按照年度，且截止到12月最后一天统计 ext price 的 sum 值</span><br><span class="line">df.groupby([&#x27;name&#x27;, pd.Grouper(key=&#x27;date&#x27;, freq=&#x27;A-DEC&#x27;)])[&#x27;ext price&#x27;].sum()</span><br><span class="line"># 按月的平均重新采样</span><br><span class="line">df[&#x27;Close&#x27;].resample(&#x27;M&#x27;).mean()</span><br><span class="line"># https://pandas.pydata.org/pandas-docs/stable/user_guide/timeseries.html#offset-aliases</span><br><span class="line"># 取时间范围，并取工作日</span><br><span class="line">rng = pd.date_range(start=&quot;6/1/2016&quot;,end=&quot;6/30/2016&quot;,freq=&#x27;B&#x27;)</span><br><span class="line"># 重新定时数据频度，按一定补充方法</span><br><span class="line">df.asfreq(&#x27;D&#x27;, method=&#x27;pad&#x27;)</span><br><span class="line"># 时区，df.tz_convert(&#x27;Europe/Berlin&#x27;)</span><br><span class="line">df.time.tz_localize(tz=&#x27;Asia/Shanghai&#x27;)</span><br><span class="line"># 转北京时间</span><br><span class="line">df[&#x27;Time&#x27;] = df[&#x27;Time&#x27;].dt.tz_localize(&#x27;UTC&#x27;).dt.tz_convert(&#x27;Asia/Shanghai&#x27;)</span><br><span class="line"># 查看所有时区</span><br><span class="line">from pytz import all_timezones</span><br><span class="line">print (all_timezones)</span><br><span class="line"># 时长，多久，两个时间间隔时间，时差</span><br><span class="line">df[&#x27;duration&#x27;] = pd.to_datetime(df[&#x27;end&#x27;]) - pd.to_datetime(df[&#x27;begin&#x27;])</span><br><span class="line"># 指定时间进行对比</span><br><span class="line">df.Time.astype(&#x27;datetime64[ns]&#x27;) &lt; pd.to_datetime(&#x27;2019-12-11 20:00:00&#x27;, format=&#x27;%Y-%m-%d %H:%M:%S&#x27;)</span><br></pre></td></tr></table></figure>
<h3 id="常用备忘"><a href="#常用备忘" class="headerlink" title="常用备忘"></a>常用备忘</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 解决科学计数法问题</span><br><span class="line">df = pd.read_csv(&#x27;111.csv&#x27;, sep=&#x27;\t&#x27;).fillna(&#x27;&#x27;)[:].astype(&#x27;str&#x27;)</span><br><span class="line"># 和订单量相关性最大到小显示</span><br><span class="line">dd.corr().total_order_num.sort_values(ascending=False)</span><br><span class="line"></span><br><span class="line"># 解析列表、json 字符串</span><br><span class="line">import ast</span><br><span class="line">ast.literal_eval(&quot;[&#123;&#x27;id&#x27;: 7, &#x27;name&#x27;: &#x27;Funny&#x27;&#125;]&quot;)</span><br><span class="line"></span><br><span class="line"># Series apply method applies a function to</span><br><span class="line"># every element in a Series and returns a Series</span><br><span class="line">ted.ratings.apply(str_to_list).head()</span><br><span class="line"># lambda is a shorter alternative</span><br><span class="line">ted.ratings.apply(lambda x: ast.literal_eval(x))</span><br><span class="line"># an even shorter alternative is to apply the </span><br><span class="line"># function directly (without lambda)</span><br><span class="line">ted.ratings.apply(ast.literal_eval)</span><br><span class="line"># 索引 index 使用 apply()</span><br><span class="line">df.index.to_series().apply()</span><br></pre></td></tr></table></figure>
<h3 id="样式展示"><a href="#样式展示" class="headerlink" title="样式展示"></a>样式展示</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"># https://pbpython.com/styling-pandas.html</span><br><span class="line">df[&#x27;per_cost&#x27;] = df[&#x27;per_cost&#x27;].map(&#x27;&#123;:,.2f&#125;%&#x27;.format) # 显示%比形式</span><br><span class="line"># 指定列表（值大于0）加背景色</span><br><span class="line">df.style.applymap(lambda x: &#x27;background-color: grey&#x27; if x&gt;0 else &#x27;&#x27;,</span><br><span class="line">                  subset=pd.IndexSlice[:, [&#x27;B&#x27;, &#x27;C&#x27;]])</span><br><span class="line"></span><br><span class="line"># 最大值最小值加背景色</span><br><span class="line">df.style.highlight_max(color=&#x27;lightgreen&#x27;).highlight_min(color=&#x27;#cd4f39&#x27;)</span><br><span class="line">df.style.format(&#x27;&#123;:.2%&#125;&#x27;, subset=pd.IndexSlice[:, [&#x27;B&#x27;]]) # 显示百分号</span><br><span class="line"></span><br><span class="line"># 指定各列的样式</span><br><span class="line">format_dict = &#123;&#x27;sum&#x27;:&#x27;$&#123;0:,.0f&#125;&#x27;,</span><br><span class="line">        &#x27;date&#x27;: &#x27;&#123;:%Y-%m&#125;&#x27;,</span><br><span class="line">        &#x27;pct_of_total&#x27;: &#x27;&#123;:.2%&#125;&#x27;</span><br><span class="line">        &#x27;c&#x27;: str.upper&#125;</span><br><span class="line"></span><br><span class="line"># 一次性样式设置</span><br><span class="line">(df.style.format(format_dict) # 多种样式形式</span><br><span class="line"> .hide_index()</span><br><span class="line"> # 指定列按颜色深度表示值大小, cmap 为 matplotlib colormap</span><br><span class="line"> .background_gradient(subset=[&#x27;sum_num&#x27;], cmap=&#x27;BuGn&#x27;)</span><br><span class="line"> # 表格内作横向 bar 代表值大小</span><br><span class="line"> .bar(color=&#x27;#FFA07A&#x27;, vmin=100_000, subset=[&#x27;sum&#x27;], align=&#x27;zero&#x27;)</span><br><span class="line"> # 表格内作横向 bar 代表值大小</span><br><span class="line"> .bar(color=&#x27;lightgreen&#x27;, vmin=0, subset=[&#x27;pct_of_total&#x27;], align=&#x27;zero&#x27;)</span><br><span class="line"> # 下降（小于0）为红色, 上升为绿色</span><br><span class="line"> .bar(color=[&#x27;#ffe4e4&#x27;,&#x27;#bbf9ce&#x27;], vmin=0, vmax=1, subset=[&#x27;增长率&#x27;], align=&#x27;zero&#x27;)</span><br><span class="line"> # 给样式表格起个名字</span><br><span class="line"> .set_caption(&#x27;2018 Sales Performance&#x27;)</span><br><span class="line"> .hide_index())</span><br><span class="line"></span><br><span class="line"># 按条件给整行加背景色（样式）</span><br><span class="line">def background_color(row):</span><br><span class="line">    if row.pv_num &gt;= 10000:</span><br><span class="line">        return [&#x27;background-color: red&#x27;] * len(row)</span><br><span class="line">    elif row.pv_num &gt;= 100:</span><br><span class="line">        return [&#x27;background-color: yellow&#x27;] * len(row)</span><br><span class="line">    return [&#x27;&#x27;] * len(row)</span><br><span class="line"># 使用</span><br><span class="line">df.style.apply(background_color, axis=1)</span><br></pre></td></tr></table></figure>
<h3 id="表格中直方图-sparkline图"><a href="#表格中直方图-sparkline图" class="headerlink" title="表格中直方图, sparkline图"></a>表格中直方图, sparkline图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">import sparklines</span><br><span class="line">import numpy as np</span><br><span class="line">def sparkline_str(x):</span><br><span class="line">    bins=np.histogram(x)[0]</span><br><span class="line">    sl = &#x27;&#x27;.join(sparklines.sparklines(bins))</span><br><span class="line">    return sl</span><br><span class="line">sparkline_str.__name__ = &quot;sparkline&quot;</span><br><span class="line"># 画出趋势图，保留两位小数</span><br><span class="line">df.groupby(&#x27;name&#x27;)[&#x27;quantity&#x27;, &#x27;ext price&#x27;].agg([&#x27;mean&#x27;, sparkline_str]).round(2)</span><br><span class="line"></span><br><span class="line"># sparkline 图形</span><br><span class="line"># https://hugoworld.wordpress.com/2019/01/26/sparklines-in-jupyter-notebooks-ipython-and-pandas/</span><br><span class="line">def sparkline(data, figsize=(4, 0.25), **kwargs):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    creates a sparkline</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">    # Turn off the max column width so the images won&#x27;t be truncated</span><br><span class="line">    pd.set_option(&#x27;display.max_colwidth&#x27;, -1)</span><br><span class="line"></span><br><span class="line">    # Turning off the max column will display all the data</span><br><span class="line">    # if gathering into sets / array we might want to restrict to a few items</span><br><span class="line">    pd.set_option(&#x27;display.max_seq_items&#x27;, 3)</span><br><span class="line"></span><br><span class="line">    #Monkey patch the dataframe so the sparklines are displayed</span><br><span class="line">    pd.DataFrame._repr_html_ = lambda self: self.to_html(escape=False)</span><br><span class="line"></span><br><span class="line">    from matplotlib import pyplot as plt</span><br><span class="line">    import base64</span><br><span class="line">    from io import BytesIO</span><br><span class="line"></span><br><span class="line">    data = list(data)</span><br><span class="line"></span><br><span class="line">    *_, ax = plt.subplots(1, 1, figsize=figsize, **kwargs)</span><br><span class="line">    ax.plot(data)</span><br><span class="line">    ax.fill_between(range(len(data)), data, len(data)*[min(data)], alpha=0.1)</span><br><span class="line">    ax.set_axis_off()</span><br><span class="line"></span><br><span class="line">    img = BytesIO()</span><br><span class="line">    plt.savefig(img)</span><br><span class="line">    plt.close()</span><br><span class="line">    return &#x27;&lt;img src=&quot;data:image/png;base64, &#123;&#125;&quot; /&gt;&#x27;.format(base64.b64encode(img.getvalue()).decode())</span><br><span class="line"></span><br><span class="line"># 使用</span><br><span class="line">df.groupby(&#x27;name&#x27;)[&#x27;quantity&#x27;, &#x27;ext price&#x27;].agg([&#x27;mean&#x27;, sparkline])</span><br><span class="line">df.apply(sparkline, axis=1) # 仅支持横向数据画线，可做 T 转置</span><br></pre></td></tr></table></figure>
<h3 id="可视化"><a href="#可视化" class="headerlink" title="可视化"></a>可视化</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">kind : str</span><br><span class="line">- &#x27;line&#x27; : line plot (default)</span><br><span class="line">- &#x27;bar&#x27; : vertical bar plot</span><br><span class="line">- &#x27;barh&#x27; : horizontal bar plot</span><br><span class="line">- &#x27;hist&#x27; : histogram</span><br><span class="line">- &#x27;box&#x27; : boxplot</span><br><span class="line">- &#x27;kde&#x27; : Kernel Density Estimation plot</span><br><span class="line">- &#x27;density&#x27; : same as &#x27;kde&#x27;</span><br><span class="line">- &#x27;area&#x27; : area plot</span><br><span class="line">- &#x27;pie&#x27; : pie plot</span><br></pre></td></tr></table></figure>
<h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">df88.plot.bar(y=&#x27;rate&#x27;, figsize=(20, 10)) # 图形大小，单位英寸</span><br><span class="line">df_1[df_1.p_day &gt; &#x27;2019-06-01&#x27;].plot.bar(x=&#x27;p_day&#x27;, y=[&#x27;total_order_num&#x27;,&#x27;order_user&#x27;], figsize=(16, 6)) # 柱状图</span><br><span class="line"># 每条线一个站点，各站点的 home_remain, stack的意思是堆叠，堆积</span><br><span class="line"># unstack 即“不要堆叠”</span><br><span class="line">(df[(df.p_day &gt;= &#x27;2019-05-1&#x27;) &amp; (df.utype == &#x27;老客&#x27;)].groupby([&#x27;p_day&#x27;, &#x27;site_id&#x27;])[&#x27;home_remain&#x27;].sum().unstack().plot.line())</span><br><span class="line">#  折线图，多条, x 轴默认为 index</span><br><span class="line">dd.plot.line(x=&#x27;p_day&#x27;, y=[&#x27;uv_all&#x27;, &#x27;home_remain&#x27;])</span><br><span class="line">dd.loc[&#x27;新访客&#x27;, 2].plot.scatter(x=&#x27;order_user&#x27;, y=&#x27;paid_order_user&#x27;) # 散点图</span><br><span class="line">dd.plot.bar(color=&#x27;blue&#x27;) # 柱状图, barh 为横向柱状图</span><br><span class="line">sns.heatmap(dd.corr()) # 相关性可视化</span><br><span class="line">#  刻度从0开始，指定范围 ylim=(0,100), x 轴相同</span><br><span class="line">s.plot.line(ylim=0)</span><br><span class="line"></span><br><span class="line"># 折线颜色 https://matplotlib.org/examples/color/named_colors.html</span><br><span class="line"># 样式( &#x27;-&#x27;,&#x27;--&#x27;,&#x27;-.&#x27;,&#x27;:&#x27; )</span><br><span class="line"># 折线标记 https://matplotlib.org/api/markers_api.html</span><br><span class="line"># grid=True 显示刻度 etc: https://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html</span><br><span class="line">s.plot.line(color=&#x27;green&#x27;, linestyle=&#x27;-&#x27;, marker=&#x27;o&#x27;)</span><br><span class="line"></span><br><span class="line"># 两个图绘在一起</span><br><span class="line">[df[&#x27;数量&#x27;].plot.kde(), df[&#x27;数量&#x27;].plot.hist()]</span><br><span class="line"></span><br><span class="line"># 对表中的数据按颜色可视化</span><br><span class="line">import seaborn as sns</span><br><span class="line">cm = sns.light_palette(&quot;green&quot;, as_cmap=True)</span><br><span class="line">df.style.background_gradient(cmap=cm, axis=1)</span><br><span class="line"></span><br><span class="line"># 将数据转化为二维数组</span><br><span class="line">[i for i in zip([i.strftime(&#x27;%Y-%m-%d&#x27;) for i in s.index.to_list()], s.to_list())]</span><br><span class="line"></span><br><span class="line"># 和 plot 用法一样 https://hvplot.pyviz.org/user_guide/Plotting.html</span><br><span class="line">import hvplot.pandas</span><br><span class="line"></span><br><span class="line"># 打印 Sqlite 建表语句</span><br><span class="line">print(pd.io.sql.get_schema(fdf, &#x27;table_name&#x27;))</span><br></pre></td></tr></table></figure>
<h3 id="notebook问题"><a href="#notebook问题" class="headerlink" title="notebook问题"></a>notebook问题</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># jupyter notebooks plt 图表配置</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">plt.rcParams[&#x27;figure.figsize&#x27;] = (15.0, 8.0) # 固定显示大小</span><br><span class="line">plt.rcParams[&#x27;font.family&#x27;] = [&#x27;sans-serif&#x27;] # 显示中文问题</span><br><span class="line">plt.rcParams[&#x27;font.sans-serif&#x27;] = [&#x27;SimHei&#x27;] # 显示中文问题</span><br><span class="line"></span><br><span class="line"># 输出单行全部变量</span><br><span class="line">from IPython.core.interactiveshell import InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = &#x27;all&#x27;</span><br><span class="line"></span><br><span class="line"># jupyter notebooks 页面自适应宽度</span><br><span class="line">from IPython.core.display import display, HTML</span><br><span class="line">display(HTML(&quot;&lt;style&gt;.container &#123; width:100% !important; &#125;&lt;/style&gt;&quot;))</span><br><span class="line"># 背景白色 &lt;style&gt;#notebook_panel &#123;background: #ffffff;&#125;&lt;/style&gt;</span><br><span class="line"></span><br><span class="line"># jupyter notebooks 嵌入页面内容</span><br><span class="line">from IPython.display import IFrame</span><br><span class="line">IFrame(&#x27;https://arxiv.org/pdf/1406.2661.pdf&#x27;, width=800, height=450)</span><br><span class="line"></span><br><span class="line"># Markdown 一个 cell 不支持多张粘贴图片</span><br><span class="line"># 一个文件打印打开只显示一张图片问题解决</span><br><span class="line"># /site-packages/notebook/static/notebook/js/main.min.js var key 处</span><br><span class="line"># 33502、33504 行</span><br><span class="line">key = utils.uuid().slice(2,6)+encodeURIandParens(blob.name);</span><br><span class="line">key = utils.uuid().slice(2,6)+Object.keys(that.attachments).length;</span><br><span class="line"># https://github.com/ihnorton/notebook/commit/55687c2dc08817da587977cb6f19f8cc0103bab1</span><br><span class="line"></span><br><span class="line"># 多行输出</span><br><span class="line">from IPython.core.interactiveshell import InteractiveShell</span><br><span class="line">InteractiveShell.ast_node_interactivity = &#x27;all&#x27; #默认为&#x27;last&#x27;</span><br><span class="line"></span><br><span class="line"># 执行 shell 命令: ! &lt;命令语句&gt;</span><br><span class="line"></span><br><span class="line"># 在线可视化工具</span><br><span class="line">https://plot.ly/create</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/04/02/hello-world/" rel="prev" title="Hello World">
                  <i class="fa fa-chevron-left"></i> Hello World
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">mikoto</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  





</body>
</html>
